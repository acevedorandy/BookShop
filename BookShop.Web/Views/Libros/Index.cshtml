@model IEnumerable<BookShop.Web.Models.LibroViewModel>
@{
    ViewData["Title"] = "Inventario de Libros";
}

<div class="row mb-3">
    <div class="col-md-6">
        <h2><i class="bi bi-collection"></i> Inventario de Libros</h2>
    </div>
    <div class="col-md-6 text-end">
        <a asp-action="Create" class="btn btn-primary">
            <i class="bi bi-plus-circle"></i> Nuevo Libro
        </a>
    </div>
</div>

<!-- Filtros y Búsqueda -->
<div class="card mb-4">
    <div class="card-body">
        <form asp-action="Index" method="get" class="row g-3">
            <div class="col-md-6">
                <div class="input-group">
                    <span class="input-group-text"><i class="bi bi-search"></i></span>
                    <input type="text" class="form-control" name="searchString" value="@ViewData["CurrentFilter"]" 
                           placeholder="Buscar por título o ISBN...">
                    <button type="submit" class="btn btn-outline-primary">Buscar</button>
                </div>
            </div>
            <div class="col-md-6">
                <div class="btn-group" role="group">
                    <a asp-action="Index" asp-route-sortOrder="@ViewData["TituloSortParm"]" 
                       class="btn btn-outline-secondary">
                        <i class="bi bi-sort-alpha-down"></i> Título
                    </a>
                    <a asp-action="Index" asp-route-sortOrder="@ViewData["PrecioSortParm"]" 
                       class="btn btn-outline-secondary">
                        <i class="bi bi-currency-dollar"></i> Precio
                    </a>
                    <a asp-action="Index" asp-route-sortOrder="@ViewData["StockSortParm"]" 
                       class="btn btn-outline-secondary">
                        <i class="bi bi-box"></i> Stock
                    </a>
                </div>
            </div>
        </form>
    </div>
</div>

<!-- Tabla de Libros -->
<div class="card">
    <div class="card-body">
        <div class="table-responsive">
            <table class="table table-striped table-hover">
                <thead class="table-dark">
                    <tr>
                        <th>Portada</th>
                        <th>Título</th>
                        <th>Autor</th>
                        <th>Género</th>
                        <th>ISBN</th>
                        <th>Año</th>
                        <th>Precio</th>
                        <th>Stock</th>
                        <th>Acciones</th>
                    </tr>
                </thead>
                <tbody>
                    @if (Model.Any())
                    {
                        @foreach (var item in Model)
                        {
                            <tr class="@(item.StockBajo ? "table-warning" : "")">
                                <td>
                                    @if (!string.IsNullOrEmpty(item.Portada))
                                    {
                                        <img src="@item.Portada" alt="Portada" class="img-thumbnail" style="max-width: 50px; max-height: 70px;" />
                                    }
                                    else
                                    {
                                        <div class="bg-light border rounded d-flex align-items-center justify-content-center" 
                                             style="width: 50px; height: 70px;">
                                            <i class="bi bi-book text-muted"></i>
                                        </div>
                                    }
                                </td>
                                <td>
                                    <strong>@item.Titulo</strong>
                                    @if (item.StockBajo)
                                    {
                                        <span class="badge bg-warning text-dark ms-1">
                                            <i class="bi bi-exclamation-triangle"></i> Stock Bajo
                                        </span>
                                    }
                                </td>
                                <td>@item.NombreAutor</td>
                                <td>@item.NombreGenero</td>
                                <td><code>@item.ISBN</code></td>
                                <td>@item.AñoPublicacion</td>
                                <td>
                                    <span class="badge bg-success fs-6">
                                        $@item.Precio.ToString("N2")
                                    </span>
                                </td>
                                <td>
                                    <span class="badge @(item.StockBajo ? "bg-danger" : "bg-primary") fs-6">
                                        @item.Stock
                                    </span>
                                </td>
                                <td>
                                    <div class="btn-group" role="group">
                                        <a asp-action="Edit" asp-route-id="@item.LibroID" 
                                           class="btn btn-sm btn-outline-primary" title="Editar">
                                            <i class="bi bi-pencil"></i>
                                        </a>
                                        <a asp-action="Delete" asp-route-id="@item.LibroID" 
                                           class="btn btn-sm btn-outline-danger" title="Eliminar">
                                            <i class="bi bi-trash"></i>
                                        </a>
                                        <a href="@Url.Action("Create", "Ventas", new { libroId = item.LibroID })" 
                                           class="btn btn-sm btn-outline-success" title="Vender">
                                            <i class="bi bi-cart-plus"></i>
                                        </a>
                                    </div>
                                </td>
                            </tr>
                        }
                    }
                    else
                    {
                        <tr>
                            <td colspan="9" class="text-center py-4">
                                <div class="text-muted">
                                    <i class="bi bi-inbox display-4"></i>
                                    <p class="mt-2">No se encontraron libros</p>
                                    <a asp-action="Create" class="btn btn-primary">
                                        <i class="bi bi-plus-circle"></i> Agregar Primer Libro
                                    </a>
                                </div>
                            </td>
                        </tr>
                    }
                </tbody>
            </table>
        </div>
    </div>
</div>

<!-- Resumen del Inventario -->
<div class="row mt-4">
    <div class="col-md-3">
        <div class="card bg-primary text-white">
            <div class="card-body text-center">
                <h5 class="card-title">Total Libros</h5>
                <h3 class="mb-0">@Model.Count()</h3>
            </div>
        </div>
    </div>
    <div class="col-md-3">
        <div class="card bg-success text-white">
            <div class="card-body text-center">
                <h5 class="card-title">Stock Total</h5>
                <h3 class="mb-0">@Model.Sum(l => l.Stock)</h3>
            </div>
        </div>
    </div>
    <div class="col-md-3">
        <div class="card bg-info text-white">
            <div class="card-body text-center">
                <h5 class="card-title">Valor Total</h5>
                <h3 class="mb-0">$@Model.Sum(l => l.Precio * l.Stock).ToString("N2")</h3>
            </div>
        </div>
    </div>
    <div class="col-md-3">
        <div class="card bg-warning text-white">
            <div class="card-body text-center">
                <h5 class="card-title">Stock Bajo</h5>
                <h3 class="mb-0">@Model.Count(l => l.StockBajo)</h3>
            </div>
        </div>
    </div>
</div>
